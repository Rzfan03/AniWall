---
const url = new URL(Astro.request.url);
const query = url.searchParams.get("search") || "";
const apiUrl = await fetch(`https://api.waifu.im/search?=${query}&limit=30`);
const data = await apiUrl.json();
const images = data.images;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>AniWall</title>
	</head>
	<body class="bg-gray-900 mx-5 mt-5 mb-5">


		<div class="text-center mb-8 mt-20">
			<h1 class="text-white text-6xl font-bold">AniWall</h1>
			<p class="text-white text-1xl">Temukan Wallpaper Waifu Kesukaan mu!</p>
		</div>

		<div id="search-bar" class="flex justify-center mt-12 mb-8 items-center">
			<form action="">
				<input type="text" name="search" class="text-white outline-0 border-2 border-gray-800 rounded-full p-2 w-120 max-md:w-90 max-md:py-3" value="" placeholder="   Cari Waifu mu!">
			</form>
		</div>



		<div class="grid grid-cols-2 md:grid-cols-4 max-md:grid-cols-1 gap-4 mt-19">
  {images.map(img => (
	<div class="bg-gray-800 h-fit w-fit p-5 rounded-md">
		<img src={img.url} alt="wallpaper" class="rounded-md shadow h-auto" />
		<h1 class="text-1xl mt-2 text-white font-bold">Images_id : {img.image_id}</h1>
		<p class="text-white ">Favorite : {img.favorites}</p>
		<p class="text-white text-xs">uploaded_at : 
			{img.uploaded_at.substring(0, 4)}
		</p>

	</div>
  ))}
       </div>


	   <footer class="border-t-2 border-gray-800 mt-5 w-full text-white flex max-md:flex-col max-md:justify-center justify-between items-center">
		<h1 class="text-white mt-5">Made by <a href="https://github.com/Rzfan03" target="_blank">Rzfan03</a></h1>
		<p class="text-white mt-2">api : <a href="https://www.waifu.im/" target="_blank">waifu.im</a></p>
	   </footer>





	</body>
</html>
